insert
foo=bar
----
ok

trace
----
Open(ROOT)
Unlink(TMP_ROOT)
Create(TMP_ROOT, 0)
Write(0, 0, {\"max_sst_seqnum\":0,\"next_sst_id\":0,\"l0\":[],\"ssts\":[],\"wals\":[]})
Rename(TMP_ROOT, ROOT)
Open(ROOT)
Sync(0)
Unlink(wal1)
Create(wal1, 1)
Sync(1)
Unlink(TMP_ROOT)
Create(TMP_ROOT, 2)
Write(2, 0, {\"max_sst_seqnum\":0,\"next_sst_id\":0,\"l0\":[],\"ssts\":[],\"wals\":[\"wal1\"]})
Rename(TMP_ROOT, ROOT)
Open(ROOT)
Sync(2)
Write(1, 0, \x1d\x00\x00\x00)
Write(1, 4, \x00\xff\x00\x01\x02\x00\xff\x00\xff\x00\xff\x00\xff\x00\xff\x00\xff\x00\xff\x00\x01foo\x00\x01bar)
Sync(1)

insert
bar=baz
----
ok

trace
----
Write(1, 33, \x1d\x00\x00\x00)
Write(1, 37, \x00\xff\x00\x01\x03\x00\xff\x00\xff\x00\xff\x00\xff\x00\xff\x00\xff\x00\xff\x00\x01bar\x00\x01baz)
Sync(1)

flush-memtable
----
ok

trace
----
Create(sst0.sst, 3)
Write(3, 0, \x1c\x00\x00\x00\x00\x00\x00\x00bar\x00\x01\x03\x00\xff\x00\xff\x00\xff\x00\xff\x00\xff\x00\xff\x00\xff\x00\x01\x01\x00\x01baz\x1c\x00\x00\x00\x00\x00\x00\x00foo\x00\x01\x02\x00\xff\x00\xff\x00\xff\x00\xff\x00\xff\x00\xff\x00\xff\x00\x01\x01\x00\x01bar)
Write(3, 72, \'\x00\x00\x00\x00\x00\x00\x00bar\x00\x01\x03\x00\xff\x00\xff\x00\xff\x00\xff\x00\xff\x00\xff\x00\xff\x00\x01\x00\xff\x00\xff\x00\xff\x00\xff\x00\x01H\x00\xff\x00\xff\x00\xff)
Write(3, 119, \x14\x00\x00\x00\x00\x00\x00\x00bar\x00\x01\x03\x00\xff\x00\xff\x00\xff\x00\xff\x00\xff\x00\xff\x00\xff\x14\x00\x00\x00\x00\x00\x00\x00foo\x00\x01\x02\x00\xff\x00\xff\x00\xff\x00\xff\x00\xff\x00\xff\x00\xff)
Write(3, 175, /\x00\x00\x00)
Write(3, 179, <\x00\x00\x00)
Sync(3)
Open(sst0.sst)
Unlink(wal3)
Create(wal3, 4)
Sync(4)
Unlink(TMP_ROOT)
Create(TMP_ROOT, 5)
Write(5, 0, {\"max_sst_seqnum\":2,\"next_sst_id\":1,\"l0\":[\"sst0.sst\"],\"ssts\":[],\"wals\":[\"wal3\"]})
Rename(TMP_ROOT, ROOT)
Open(ROOT)
Sync(5)

scan
----
("bar", "baz")
("foo", "bar")

get
aaa
----
None

get
foo
----
Some("bar")

get
bar
----
Some("baz")

trace
----
Open(sst0.sst)
Open(sst0.sst)
Open(sst0.sst)
Open(sst0.sst)

reload
----
ok

scan
----
("bar", "baz")
("foo", "bar")

trace
----
Open(ROOT)
Open(wal3)
Unlink(TMP_ROOT)
Create(TMP_ROOT, 6)
Write(6, 0, {\"max_sst_seqnum\":2,\"next_sst_id\":1,\"l0\":[\"sst0.sst\"],\"ssts\":[],\"wals\":[]})
Rename(TMP_ROOT, ROOT)
Open(ROOT)
Sync(6)
Unlink(wal3)
Open(sst0.sst)
Unlink(wal3)
Create(wal3, 7)
Sync(7)
Unlink(TMP_ROOT)
Create(TMP_ROOT, 8)
Write(8, 0, {\"max_sst_seqnum\":2,\"next_sst_id\":1,\"l0\":[\"sst0.sst\"],\"ssts\":[],\"wals\":[\"wal3\"]})
Rename(TMP_ROOT, ROOT)
Open(ROOT)
Sync(8)
Open(sst0.sst)
